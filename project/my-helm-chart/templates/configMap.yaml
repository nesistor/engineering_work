apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  namespace: microservices-app
  labels:
    app: vault
    app.kubernetes.io/managed-by: "Helm"
    release: microservices
  annotations:
    meta.helm.sh/release-name: "microservices"
    meta.helm.sh/release-namespace: "microservices-app"
data:
  vault.hcl: |
    storage "file" {
      path = "/vault/data"
    }
    api_addr = "http://0.0.0.0:8200"
    cluster_addr = "https://0.0.0.0:8201"
    listener "tcp" {
      address = "0.0.0.0:8200"
      tls_disable = 1
    }
    disable_mlock = true
    auth "kubernetes" {
      kubernetes_host = "https://kubernetes.default.svc"
      kubernetes_ca_cert = "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
      kubernetes_token_reviewer_jwt = "/var/run/secrets/kubernetes.io/serviceaccount/token"
    }
