vault:
  image:
    repository: "us-central1-docker.pkg.dev/my-microservices-repo/vault"
    tag: "latest"
  ports:
    - "8200:8200"
  environment:
    VAULT_ADDR: http://0.0.0.0:8200
    VAULT_API_ADDR: http://localhost:8200
    VAULT_DEV_ROOT_TOKEN_ID: root_token
  volumes:
    - name: vault-data
      mountPath: /vault/file
  command: "server -dev -dev-root-token-id=root_token"
  cap_add:
    - IPC_LOCK

authenticationService:
  image:
    repository: "us-central1-docker.pkg.dev/my-microservices-repo/auth-service"
    tag: "latest"
  ports:
    - "8083:80"
  environment:
    REDIS_URL: "redis:6379"
    VAULT_ADDR: "http://vault:8200"
    VAULT_TOKEN: root_token
  dependsOn:
    - redis
    - vault

loggerService:
  image:
    repository: "us-central1-docker.pkg.dev/my-microservices-repo/logger-service"
    tag: "latest"

mailerService:
  image:
    repository: "us-central1-docker.pkg.dev/my-microservices-repo/mail-service"
    tag: "latest"
  environment:
    MAIL_DOMAIN: localhost
    MAIL_HOST: mailhog
    MAIL_PORT: 1025
    MAIL_ENCRYPTION: none
    MAIL_USERNAME: ""
    MAIL_PASSWORD: ""
    FROM_NAME: "Karol"
    FROM_ADDRESS: goappdm@gmail.com

userService:
  image:
    repository: "us-central1-docker.pkg.dev/my-microservices-repo/user-service"
    tag: "latest"
  ports:
    - "8081:80"
    - "50001:50001"
  environment:
    DSN: "host=postgres-users port=5432 user=postgres password=password dbname=users sslmode=disable timezone=UTC connect_timeout=5"
    VAULT_ADDR: "http://vault:8200"
    VAULT_TOKEN: root_token
  dependsOn:
    - postgres-users
    - vault

adminService:
  image:
    repository: "us-central1-docker.pkg.dev/my-microservices-repo/admin-service"
    tag: "latest"
  ports:
    - "8082:80"
    - "50002:50001"
  environment:
    DSN: "host=postgres-admins port=5432 user=postgres password=password dbname=users sslmode=disable timezone=UTC connect_timeout=5"
    VAULT_ADDR: "http://vault:8200"
    VAULT_TOKEN: root_token
  dependsOn:
    - postgres-admins
    - vault

redis:
  image:
    repository: "redis"
    tag: "7.0"
  ports:
    - "6379:6379"

postgresUsers:
  image:
    repository: "postgres"
    tag: "14.0"
  environment:
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: password
    POSTGRES_DB: users
  volumes:
    - ./db-data/postgres-users:/var/lib/postgresql/data

postgresAdmins:
  image:
    repository: "postgres"
    tag: "14.0"
  environment:
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: password
    POSTGRES_DB: admins
  volumes:
    - ./db-data/postgres-admins:/var/lib/postgresql/data

mongo:
  image:
    repository: "mongo"
    tag: "4.2.16-bionic"
  environment:
    MONGO_INITDB_DATABASE: logs
    MONGO_INITDB_ROOT_USERNAME: admin
    MONGO_INITDB_ROOT_PASSWORD: password
  volumes:
    - ./db-data/mongo:/data/db
