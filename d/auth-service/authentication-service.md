# Authentication Service Documentation

## Introduction

This document describes the Authentication Service, a critical component of the [your project name] system. This service is responsible for managing user authentication and authorization, ensuring secure access to the application's resources.

## Features

* User and admin authentication using email and password.
* JWT-based authentication with access and refresh tokens.
* Secure storage and rotation of RSA keys using HashiCorp Vault.
* Token blacklisting with Redis for immediate token revocation.
* gRPC communication with User and Admin services for credentials validation.
* Logging functionality for monitoring and auditing.

## Architecture

The Authentication Service interacts with several other components:

* **User Service:** Provides user data and validates user credentials.
* **Admin Service:** Provides administrator data and validates admin credentials.
* **Vault:** Securely stores and manages RSA keys used for JWT signing.
* **Redis:**  Maintains a blacklist of revoked tokens.
* **Logger Service:**  Receives and stores logs generated by the Authentication Service.

## API Endpoints

The Authentication Service exposes the following API endpoints:

### Authentication

* **`/api/auth/login`**
    * Authenticates a regular user.
    * **Method:** POST
    * **Input (JSON):** 
        ```json
        {
        "email": "user@example.com",
        "password": "password"
        }
        ```
    * **Output (JSON):**
        ```json
        {
        "error": false,
        "message": "User user@example.com authenticated successfully",
        "status": 200,
        "data": {
        "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
        "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
        }
        ```

* **`/api/admin/login`**
    * Authenticates an administrator.
    * **Method:** POST
    * **Input (JSON):**
        ```json
        {
        "email": "admin@example.com",
        "password": "password"
        }
        ```
    * **Output (JSON):**
        ```json
        {
        "error": false,
        "message": "Admin admin@example.com authenticated successfully",
        "status": 200,
        "data": {
        "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
        "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
        }
        ```

### Token Management

* **`/api/auth/refresh`**
    * Refreshes an access token using a refresh token.
    * **Method:** POST
    * **Input (JSON):**
        ```json
        {
        "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
        ```
    * **Output (JSON):**
        ```json
        {
        "error": false,
        "message": "Access token refreshed successfully",
        "status": 200,
        "data": {
        "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
        }
        ```

* **`/api/auth/revoke`**
    * Revokes a token (blacklists it in Redis).
    * **Method:** POST
    * **Input (JSON):**
        ```json
        {
        "token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
        ```
    * **Output (JSON):**
        ```json
        {
        "error": false,
        "message": "Token revoked successfully",
        "status": 200
        }
        ```
* **`/auth/logout`**
    * Revokes the current user's access token.
    * **Method:** POST
    * **Input:** Requires a valid access token in the `Authorization` header.
    * **Output (JSON):**
        ```json
        {
        "error": false,
        "message": "Logged out successfully",
        "status": 200
        }
        ```

## Authentication Flow

1.  **Login:** The client sends login credentials (email and password) to either `/api/auth/login` (for users) or `/api/admin/login` (for admins).
2.  **Validation:** The Authentication Service communicates with the respective User or Admin service via gRPC to validate the credentials.
3.  **Token Generation:** Upon successful validation, the service generates an access token (short-lived) and a refresh token (long-lived).
4.  **Token Storage:** The client securely stores both tokens.
5.  **Access:** The client includes the access token in the `Authorization` header for all subsequent requests to protected resources.
6.  **Refresh:**  When the access token expires, the client uses the refresh token to obtain a new access token via `/api/auth/refresh`.
7.  **Revocation:**  Tokens can be revoked (blacklisted) at any time using the `/api/auth/revoke` endpoint, preventing further access.

## Security Considerations

* **Key Rotation:**  RSA keys are rotated hourly to minimize the impact of compromised keys.
* **Blacklisting:** Revoked tokens are blacklisted in Redis, ensuring they cannot be used even if they haven't expired.
* **HTTPS:** The service should be deployed over HTTPS to protect data in transit.
* **Vault Security:** HashiCorp Vault should be properly secured with appropriate authentication and authorization mechanisms.

## Error Handling

The API provides informative error messages in JSON format to assist clients in troubleshooting issues.

## Logging

The service logs important events, including login attempts, token refreshes, and token revocations. These logs are sent to the Logger Service for analysis and auditing.

## Deployment

The Authentication Service is designed to be deployed in a containerized environment using Docker.

## Future Enhancements

* **Two-Factor Authentication (2FA):**  Implement 2FA to add an extra layer of security.
* **Password Reset:** Develop a self-service password reset mechanism.
* **Token Versioning:** Implement token versioning to allow for more granular control over token revocation.

## Conclusion

The Authentication Service provides a robust and secure solution for managing user authentication and authorization. Its use of JWT, Vault, and Redis ensures a high level of security, while its API makes it easy to integrate with other services.